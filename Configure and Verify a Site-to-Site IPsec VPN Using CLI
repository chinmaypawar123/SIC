//Part 1: Configure router
//Execute command on all routers

R(config)# enable secret enpa55

//Execute command on all routers
R(config)# line console 0
R(config-line)# password conpa55
R(config-line)# login

//Execute command on all routers
R(config)# ip domain-name ccnasecurity.com
R(config)# username admin secret adminpa55
R(config)# line vty 0 4
R(config-line)# login local
R(config)# crypto key generate rsa
R1(config)# router ospf 1
R1(config)# network 192.168.1.0 0.0.0.255 area 0
R1(config)# network 10.1.1.0 0.0.0.3 area 0
R2(config)# router ospf 1
R2(config)# network 192.168.2.0 0.0.0.255 area 0
R2(config)# network 10.2.2.0 0.0.0.3 area 0
R2(config)# network 10.1.1.0 0.0.0.3 area 0
R3(config)# router ospf 1
R3(config)# network 192.168.3.0 0.0.0.255 area 0
R3(config)# network 10.2.2.0 0.0.0.3 area 0

//Part 2: Configure IPsec Parameters on R1
PCA> ping 192.168.3.3
(Successful)
PCA> ping 192.168.2.3
(Successful)
PCB> ping 192.168.3.3
(Successful)
R1# show version
R1(config)# license boot module c1900 technology-package securityk9
R1# copy run start
R1# reload
R1# show version
R1(config)# access-list 110 permit ip 192.168.1.0 0.0.0.255 192.168.3.0 0.0.0.255
R1(config)# crypto isakmp policy 10
R1(config-isakmp)# encryption aes 256
R1(config-isakmp)# authentication pre-share
R1(config-isakmp)# group 5
R1(config-isakmp)# exit
R1(config)# crypto isakmp key vpnpa55 address 10.2.2.2
R1(config)# crypto ipsec transform-set VPN-SET esp-aes esp-sha-hmac
R1(config)# crypto map VPN-MAP 10 ipsec-isakmp
R1(config-crypto-map)# description VPN connection to R3
R1(config-crypto-map)# set peer 10.2.2.2
R1(config-crypto-map)# set transform-set VPN-SET
R1(config-crypto-map)# match address 110
R1(config-crypto-map)# exit
R1(config)# int se0/1/0
R1(config-if)# crypto map VPN-MAP

//Part 3: Configure IPsec Parameters on R3
R3# show version
R3(config)# license boot module c1900 technology-package securityk9
R3# copy run start
R3# reload
R3# show version
R3(config)# access-list 110 permit ip 192.168.3.0 0.0.0.255 192.168.1.0 0.0.0.255
R3(config)# crypto isakmp policy 10
R3(config-isakmp)# encryption aes 256
R3(config-isakmp)# authentication pre-share
R3(config-isakmp)# group 5
R3(config-isakmp)# exit
R3(config)# crypto isakmp key vpnpa55 address 10.1.1.2
R3(config)# crypto ipsec transform-set VPN-SET esp-aes esp-sha-hmac
R3(config)# crypto map VPN-MAP 10 ipsec-isakmp
R3(config-crypto-map)# description VPN connection to R1
R3(config-crypto-map)# set peer 10.1.1.2
R3(config-crypto-map)# set transform-set VPN-SET
R3(config-crypto-map)# match address 110
R3(config-crypto-map)# exit
R3(config)# int se0/1/0
R3(config-if)# crypto map VPN-MAP

//Part 4: Verify the IPsec VPN
R1# show crypto ipsec sa
PCC>ping 192.168.1.3
(Successful)
R1# show crypto ipsec sa
PCB>ping 192.168.1.3
(Successful)
R1#ping 192.168.3.3
(Successful)
R3#ping 192.168.1.3
(Successful)
R1# show crypto ipsec sa
